
import:
  dcc: dash.dcc
  html: dash.html
  dbc: dash_bootstrap_components
  daq: dash_daq

external_stylesheets:
  - https://codepen.io/chriddyp/pen/bWLwgP.css
  - https://www.w3schools.com/w3css/4/w3.css
  # - https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css
  - https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css

external_scripts:
  # - https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML
  - https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.0/es5/latest?tex-mml-chtml.js

app:
  jupyter_dash.JupyterDash:
    external_stylesheets: ${external_stylesheets}
    external_scripts: ${external_scripts}
    title: elliptic
    suppress_callback_exceptions: False

run_server:
  host: '0.0.0.0'
  port: 8050
  extra_files:
    - elliptic.yaml
  debug: True

input_p:
  dbc.Col:
    width: 5
    children:
      - dbc.Label: p
      - daq.Slider:
          id: user-input-p
          min: 3
          max: 100
          value: 11 # 11th prime=37
          updatemode: drag
          handleLabel: 'me!'

input_a:
  dbc.Col:
    width: 3
    children:
    - dbc.Label: a
    - dbc.Input:
        id: user-input-a
        type: number
        value: 0

input_b:
  dbc.Col:
    width: 3
    children:
    - dbc.Label: b
    - dbc.Input:
        id: user-input-b
        type: number
        value: 7
parameters:
  html.Div:
    children:
      - dbc.Row:
          children:
            - ${input_p}
            - ${input_a}
            - ${input_b}

empty_graph:
  data: []
  layout:
    xaxis:
      showticklabels: False
      ticks: ''
      showgrid: False
      zeroline: False
    yaxis:
      showticklabels: False
      ticks: ''
      showgrid: False
      zeroline: False

layout:
  dbc.Container:
    children:
    - dbc.Row:
        children:
        - dbc.Col:
            width: 8
            children:
            - html.H1: Finite Elliptic Curves
            - html.Div: BTC++ 2022, Austin TX
    - dbc.Row:
        children:
        - dbc.Col:
            width: 8
            children:
            - ${parameters}
    - html.Br:
    - dbc.Tabs:
        id: lesson
        active_tab: signatures
        children:
        - dbc.Tab:
            tab_id: point-addition
            label: Point Addition
            children:
            - dcc.Store:
                id: add-points
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dcc.Graph:
                        id: add-graph
                        mathjax: True
                        config:
                          displayModeBar: False
                        figure: ${empty_graph}
        - dbc.Tab:
            tab_id: point-multiplication
            label: Point Multiplication
            children:
            - dcc.Store:
                id: multiply-points
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dbc.Row:
                        children:
                        - dbc.Col:
                            width: 2
                            children:
                            - dbc.Label: 'n'
                            - dbc.Input:
                                id: user-input-n
                                type: number
                                value: 0
                                min: 0
                        - dbc.Col:
                            width: 3
                            children:
                            - dbc.RadioItems:
                                options:
                                - label: 'Multiply'
                                  value: 1
                                - label: 'Inverse'
                                  value: 2
                                value: 1
                                inline: True
                            - dbc.Checklist:
                                options:
                                - label: 'show subgroup'
                                  value: 1
                                value: []
                                switch: True

                    - dcc.Graph:
                        id: multiply-graph
                        mathjax: True
                        config:
                          displayModeBar: False
                        figure: ${empty_graph}
        - dbc.Tab:
            tab_id: secret-sharing
            label: Secret Sharing
            children:
            - dcc.Store:
                id: alice-pub
            - dcc.Store:
                id: alice-secret
            - dcc.Store:
                id: bob-pub
            - dcc.Store:
                id: bob-secret
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dbc.Row:
                        children:
                        - dbc.Col:
                            width: 6
                            children:
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 12
                                    children:
                                    - dbc.RadioItems:
                                        id: alice-sharing-mode
                                        options:
                                        - label: 'Pub Key'
                                          value: 1
                                        - label: 'Shared Secret'
                                          value: 2
                                        - label: 'Message'
                                          value: 3
                                        value: 1
                                        inline: True
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Alice Priv Key
                                    - dbc.Input:
                                        id: alice-priv
                                        type: number
                                        value: 5
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Alice Pub Key
                                    - dcc.Markdown:
                                        id: alice-pub-key
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Shared Secret
                                    - dcc.Markdown:
                                        id: alice-shared-secret
                        - dbc.Col:
                            width: 6
                            children:
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 12
                                    children:
                                    - dbc.RadioItems:
                                        id: bob-sharing-mode
                                        options:
                                        - label: 'Pub Key'
                                          value: 1
                                        - label: 'Shared Secret'
                                          value: 2
                                        - label: 'Message'
                                          value: 3
                                        value: 1
                                        inline: True
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Bob Priv Key
                                    - dbc.Input:
                                        id: bob-priv
                                        type: number
                                        value: 7
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Bob Pub Key
                                    - dcc.Markdown:
                                        id: bob-pub-key
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Shared Secret
                                    - dcc.Markdown:
                                        id: bob-shared-secret
                    - dbc.Row:
                        children:
                          - dbc.Col:
                              width: 6
                              children:
                              - html.Div:
                                  id: pub-graph-alice-outer
                                  children:
                                  - dcc.Graph:
                                      id: pub-graph-alice
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: secret-graph-alice-outer
                                  children:
                                  - dcc.Graph:
                                      id: secret-graph-alice
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: encrypt-alice-outer
                                  children:
                                  - html.Br:
                                  - dbc.Textarea:
                                      id: alice-message
                                      value:
                                      placeholder: Enter message to send/encrypt
                                      style:
                                        height: 135
                                  - html.Br:
                                  - dbc.Row:
                                      justify: center
                                      children:
                                        - dbc.Col:
                                            width: 3
                                            children:
                                            - html.Div:
                                                id: alice-error
                                                children:
                                        - dbc.Col:
                                            width: 4
                                            children:
                                            - dbc.ButtonGroup:
                                                children:
                                                - dbc.Button:
                                                    id: alice-encrypt
                                                    children: Encrypt
                                                    color: primary
                                                - dbc.Button:
                                                    id: alice-decrypt
                                                    children: Decrypt
                                                    color: primary
                                                - dbc.Button:
                                                    id: alice-send
                                                    children: Send
                                                    color: success
                          - dbc.Col:
                              width: 6
                              children:
                              - html.Div:
                                  id: pub-graph-bob-outer
                                  children:
                                  - dcc.Graph:
                                      id: pub-graph-bob
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: secret-graph-bob-outer
                                  children:
                                  - dcc.Graph:
                                      id: secret-graph-bob
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: encrypt-bob-outer
                                  children:
                                  - html.Br:
                                  - dbc.Textarea:
                                      id: bob-message
                                      value:
                                      placeholder: Enter message to send/encrypt
                                      style:
                                        height: 135
                                  - html.Br:
                                  - dbc.Row:
                                      justify: center
                                      children:
                                        - dbc.Col:
                                            width: 3
                                            children:
                                            - html.Div:
                                                id: bob-error
                                                children:
                                        - dbc.Col:
                                            width: 4
                                            children:
                                            - dbc.ButtonGroup:
                                                children:
                                                - dbc.Button:
                                                    id: bob-encrypt
                                                    children: Encrypt
                                                    color: primary
                                                - dbc.Button:
                                                    id: bob-decrypt
                                                    children: Decrypt
                                                    color: secondary
                                                - dbc.Button:
                                                    id: bob-send
                                                    children: Send
                                                    color: success
        - dbc.Tab:
            tab_id: signatures
            label: Signatures
            children:
            - dcc.Store:
                id: sign-pub
            - dcc.Store:
                id: sign-k-points
            - dcc.Store:
                id: validate-points
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dbc.Row:
                        children:
                        - dbc.Col:
                            width: 6
                            children:
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 12
                                    children:
                                    - dbc.RadioItems:
                                        id: sign-sharing-mode
                                        options:
                                        - label: Pub Key
                                          value: 1
                                        - label: k secret
                                          value: 2
                                        - label: Message
                                          value: 3
                                        value: 1
                                        inline: True
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 2
                                    children:
                                    - dbc.Label: Priv key
                                    - dbc.Input:
                                        id: sign-priv
                                        type: number
                                        value: 7
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label: Pub key
                                    - dcc.Markdown:
                                        id: sign-pub-key
                                        children: ''
                                - dbc.Col:
                                    width: 2
                                    children:
                                    - dbc.Label: Rand k
                                    - dbc.Input:
                                        id: sign-k
                                        type: number
                                        value: 10
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label: P_k
                                    - dcc.Markdown:
                                        id: sign-k-key
                                        children: ''
                            - html.Div:
                                id: pub-graph-sign-outer
                                children:
                                - dcc.Graph:
                                    id: pub-graph-sign
                                    mathjax: True
                                    config:
                                      displayModeBar: False
                                    figure: ${empty_graph}
                            - html.Div:
                                id: k-graph-sign-outer
                                children:
                                - dcc.Graph:
                                    id: k-graph-sign
                                    mathjax: True
                                    config:
                                      displayModeBar: False
                                    figure: ${empty_graph}
                            - html.Div:
                                id: sign-message-outer
                                children:
                                - dbc.Col:
                                    width: 6
                                    children:
                                    - dbc.Textarea:
                                        id: sign-message
                                        value:
                                        placeholder: Enter message to sign
                                        style:
                                          height: 80
                        - dbc.Col:
                            width: 6
                            children:
                              dcc.Graph:
                                id: validate-graph
                                mathjax: True
                                config:
                                  displayModeBar: False
                                figure: ${empty_graph}


callbacks:
  # update_validate_points:
  #   input:
  #     - id: user-input-p
  #       attr: value
  #     - id: user-input-a
  #       attr: value
  #     - id: user-input-b
  #       attr: value
  #     - id: validate-graph
  #       attr: clickData
  #   state:
  #     - id: validate-points
  #       attr: data
  #   output:
  #     - id: validate-points
  #       attr: data
  #   callback: elliptic.dashboard.update_add_points

  show_hide_sign_pub:
    input:
      - id: sign-sharing-mode
        attr: value
    output:
      - id:  pub-graph-sign-outer
        attr: style
    callback: elliptic.dashboard.show_hide_pub

  show_hide_sign_k:
    input:
      - id: sign-sharing-mode
        attr: value
    output:
      - id:  k-graph-sign-outer
        attr: style
    callback: elliptic.dashboard.show_hide_secret


  update_sign_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: sign-priv
        attr: value
      - id: pub-graph-sign
        attr: clickData
    state:
      - id: sign-pub
        attr: data
    output:
      - id: sign-pub
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  # update_sign_k:
  #   input:
  #     - id: user-input-p
  #       attr: value
  #     - id: user-input-a
  #       attr: value
  #     - id: user-input-b
  #       attr: value
  #     - id: sign-priv
  #       attr: value
  #     - id: k-graph-sign
  #       attr: clickData
  #   state:
  #     - id: sign-k-points
  #       attr: data
  #   output:
  #     - id: sign-k-points
  #       attr: data
  #   callback: elliptic.dashboard.update_multiply_points


  pub_graph_sign:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: sign-priv
        attr: value
      - id: sign-pub
        attr: data
    output:
      - id: pub-graph-sign
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  # k_graph_sign:
  #   input:
  #     - id: user-input-p
  #       attr: value
  #     - id: user-input-a
  #       attr: value
  #     - id: user-input-b
  #       attr: value
  #     - id: sign-priv
  #       attr: value
  #     - id: sign-k-points
  #       attr: data
  #   output:
  #     - id: k-graph-sign
  #       attr: figure
  #   callback: elliptic.dashboard.multiply_graph


  render_sign_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: sign-pub
        attr: data
    output:
      - id: sign-pub-key
        attr: children
    callback: elliptic.dashboard.render_pub_key


  # render_sign_k:
  #   input:
  #     - id: user-input-p
  #       attr: value
  #     - id: user-input-a
  #       attr: value
  #     - id: user-input-b
  #       attr: value
  #     - id: sign-k-points
  #       attr: data
  #   output:
  #     - id: sign-k-key
  #       attr: children
  #   callback: elliptic.dashboard.render_pub_key


  update_validate_graph:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: validate-points
        attr: data
    output:
      - id: validate-graph
        attr: figure
    callback: elliptic.dashboard.add_graph



  add_graph:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: add-points
        attr: data
    output:
      - id: add-graph
        attr: figure

    callback: elliptic.dashboard.add_graph

  multiply_graph:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: user-input-n
        attr: value
      - id: multiply-points
        attr: data
    output:
      - id: multiply-graph
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  update_slider_label:
    input:
      - id: user-input-p
        attr: value
    output:
      - id: user-input-p
        attr: handleLabel
    callback: elliptic.dashboard.update_p_slider_label


  update_bob_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: secret-graph-bob
        attr: clickData
    state:
      - id: bob-secret
        attr: data
    output:
      - id: bob-secret
        attr: data
    callback: elliptic.dashboard.update_multiply_points


  update_alice_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: secret-graph-alice
        attr: clickData
    state:
      - id: alice-secret
        attr: data
    output:
      - id: alice-secret
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  render_alice_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-pub
        attr: data
    output:
      - id: alice-pub-key
        attr: children
    callback: elliptic.dashboard.render_pub_key

  render_alice_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-secret
        attr: data
    output:
      - id: alice-shared-secret
        attr: children
    callback: elliptic.dashboard.render_pub_key


  render_bob_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-pub
        attr: data
    output:
      - id: bob-pub-key
        attr: children
    callback: elliptic.dashboard.render_pub_key

  render_bob_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-secret
        attr: data
    output:
      - id: bob-shared-secret
        attr: children
    callback: elliptic.dashboard.render_pub_key

  update_alice_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: pub-graph-alice
        attr: clickData
    state:
      - id: alice-pub
        attr: data
    output:
      - id: alice-pub
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  update_alice_priv_bounds:
    input:
    - id: user-input-p
      attr: value
    - id: user-input-a
      attr: value
    - id: user-input-b
      attr: value
    - id: pub-graph-alice
      attr: clickData
    state:
    - id: alice-priv
      attr: value
    output:
    - id: alice-priv
      attr: max
    - id: alice-priv
      attr: value
    callback: elliptic.dashboard.priv_in_bounds

  update_bob_priv_bounds:
    input:
    - id: user-input-p
      attr: value
    - id: user-input-a
      attr: value
    - id: user-input-b
      attr: value
    - id: pub-graph-bob
      attr: clickData
    state:
    - id: bob-priv
      attr: value
    output:
    - id: bob-priv
      attr: max
    - id: bob-priv
      attr: value
    callback: elliptic.dashboard.priv_in_bounds

  pub_graph_alice:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: alice-pub
        attr: data
      - id: alice-sharing-mode
        attr: value
    output:
      - id: pub-graph-alice
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  secret_graph_alice:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: alice-secret
        attr: data
      - id: alice-sharing-mode
        attr: value
    output:
      - id: secret-graph-alice
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  secret_graph_bob:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: bob-secret
        attr: data
      - id: bob-sharing-mode
        attr: value
    output:
      - id: secret-graph-bob
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  show_hide_alice_pub:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  pub-graph-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_pub

  show_hide_alice_secret:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  secret-graph-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_secret


  show_hide_alice_message:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  encrypt-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_message


  show_hide_bob_pub:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  pub-graph-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_pub

  show_hide_bob_secret:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  secret-graph-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_secret

  show_hide_bob_message:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  encrypt-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_message

  update_bob_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: pub-graph-bob
        attr: clickData
    state:
      - id: bob-pub
        attr: data
    output:
      - id: bob-pub
        attr: data
    callback: elliptic.dashboard.update_multiply_points


  pub_graph_bob:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: bob-pub
        attr: data
      - id: bob-sharing-mode
        attr: value
    output:
      - id: pub-graph-bob
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  update_multiply_points:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: user-input-n
        attr: value
      - id: multiply-graph
        attr: clickData
    state:
      - id: multiply-points
        attr: data
    output:
      - id: multiply-points
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  update_add_points:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: add-graph
        attr: clickData
    state:
      - id: add-points
        attr: data
    output:
      - id: add-points
        attr: data
    callback: elliptic.dashboard.update_add_points


  update_message_alice:
    input:
      - id: alice-shared-secret
        attr: children
      - id: alice-encrypt
        attr: n_clicks
      - id: alice-decrypt
        attr: n_clicks
      - id: bob-send
        attr: n_clicks
    state:
      - id: bob-message
        attr: value
      - id: alice-message
        attr: value
    output:
      - id: alice-message
        attr: value
      - id: alice-error
        attr: children
    callback: elliptic.dashboard.update_message


  update_message_bob:
    input:
      - id: bob-shared-secret
        attr: children
      - id: bob-encrypt
        attr: n_clicks
      - id: bob-decrypt
        attr: n_clicks
      - id: alice-send
        attr: n_clicks
    state:
      - id: alice-message
        attr: value
      - id: bob-message
        attr: value
    output:
      - id: bob-message
        attr: value
      - id: bob-error
        attr: children
    callback: elliptic.dashboard.update_message

  update_alice_buttons:
    input:
      - id: alice-shared-secret
        attr: children
    output:
      - id: alice-encrypt
        attr: color
      - id: alice-decrypt
        attr: color
    callback: elliptic.dashboard.update_crypto_buttons


  update_bob_buttons:
    input:
      - id: bob-shared-secret
        attr: children
    output:
      - id: bob-encrypt
        attr: color
      - id: bob-decrypt
        attr: color
    callback: elliptic.dashboard.update_crypto_buttons


