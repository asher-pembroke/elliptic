
import:
  dcc: dash.dcc
  html: dash.html
  dbc: dash_bootstrap_components
  daq: dash_daq

external_stylesheets:
  - https://codepen.io/chriddyp/pen/bWLwgP.css
  - https://www.w3schools.com/w3css/4/w3.css
  # - https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css
  - https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css

external_scripts:
  # - https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML
  - https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.0.0/es5/latest?tex-mml-chtml.js

app:
  jupyter_dash.JupyterDash:
    external_stylesheets: ${external_stylesheets}
    external_scripts: ${external_scripts}
    title: elliptic
    suppress_callback_exceptions: False

run_server:
  host: '0.0.0.0'
  port: 8050
  extra_files:
    - elliptic.yaml
  debug: True

input_p:
  dbc.Col:
    width: 5
    children:
      - dbc.Label: p
      - daq.Slider:
          id: user-input-p
          min: 3
          max: 100
          value: 11 # 11th prime=37
          updatemode: drag
          handleLabel: 'me!'

input_a:
  dbc.Col:
    width: 3
    children:
    - dbc.Label: a
    - dbc.Input:
        id: user-input-a
        type: number
        value: 0

input_b:
  dbc.Col:
    width: 3
    children:
    - dbc.Label: b
    - dbc.Input:
        id: user-input-b
        type: number
        value: 7
parameters:
  html.Div:
    children:
      - dbc.Row:
          children:
            - ${input_p}
            - ${input_a}
            - ${input_b}

empty_graph:
  data: []
  layout:
    xaxis:
      showticklabels: False
      ticks: ''
      showgrid: False
      zeroline: False
    yaxis:
      showticklabels: False
      ticks: ''
      showgrid: False
      zeroline: False

layout:
  dbc.Container:
    children:
    - dbc.Row:
        children:
        - dbc.Col:
            width: 8
            children:
            - html.H1: Finite Elliptic Curves
            - html.Div: BTC++ 2022, Austin TX
    - dbc.Row:
        children:
        - dbc.Col:
            width: 8
            children:
            - ${parameters}
    - html.Br:
    - dbc.Tabs:
        id: lesson
        active_tab: secret-sharing
        children:
        - dbc.Tab:
            tab_id: point-addition
            label: Point Addition
            children:
            - dcc.Store:
                id: add-points
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dcc.Graph:
                        id: add-graph
                        mathjax: True
                        config:
                          displayModeBar: False
                        figure: ${empty_graph}
        - dbc.Tab:
            tab_id: point-multiplication
            label: Point Multiplication
            children:
            - dcc.Store:
                id: multiply-points
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dbc.Row:
                        children:
                        - dbc.Col:
                            width: 2
                            children:
                            - dbc.Label: 'n'
                            - dbc.Input:
                                id: user-input-n
                                type: number
                                value: 0
                                min: 0
                        - dbc.Col:
                            width: 3
                            children:
                            - dbc.RadioItems:
                                options:
                                - label: 'Multiply'
                                  value: 1
                                - label: 'Inverse'
                                  value: 2
                                value: 1
                                inline: True
                            - dbc.Checklist:
                                options:
                                - label: 'show subgroup'
                                  value: 1
                                value: []
                                switch: True

                    - dcc.Graph:
                        id: multiply-graph
                        mathjax: True
                        config:
                          displayModeBar: False
                        figure: ${empty_graph}
        - dbc.Tab:
            tab_id: secret-sharing
            label: Secret Sharing
            children:
            - dcc.Store:
                id: alice-pub
            - dcc.Store:
                id: alice-secret
            - dcc.Store:
                id: bob-pub
            - dcc.Store:
                id: bob-secret
            - dbc.Card:
                children:
                - dbc.CardBody:
                    children:
                    - dbc.Row:
                        children:
                        - dbc.Col:
                            width: 6
                            children:
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 12
                                    children:
                                    - dbc.RadioItems:
                                        id: alice-sharing-mode
                                        options:
                                        - label: 'Pub Key'
                                          value: 1
                                        - label: 'Shared Secret'
                                          value: 2
                                        - label: 'Encrypt'
                                          value: 3
                                        - label: 'Decrypt'
                                          value: 4 
                                        value: 1
                                        inline: True
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Alice Priv Key
                                    - dbc.Input:
                                        id: alice-priv
                                        type: number
                                        value: 5
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Alice Pub Key
                                    - dcc.Markdown:
                                        id: alice-pub-key
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Shared Secret
                                    - dcc.Markdown:
                                        id: alice-shared-secret
                        - dbc.Col:
                            width: 6
                            children:
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 12
                                    children:
                                    - dbc.RadioItems:
                                        id: bob-sharing-mode
                                        options:
                                        - label: 'Pub Key'
                                          value: 1
                                        - label: 'Shared Secret'
                                          value: 2
                                        - label: 'Encrypt'
                                          value: 3
                                        - label: 'Decrypt'
                                          value: 4
                                        value: 1
                                        inline: True
                            - dbc.Row:
                                children:
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Bob Priv Key
                                    - dbc.Input:
                                        id: bob-priv
                                        type: number
                                        value: 7
                                        min: 1
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Bob Pub Key
                                    - dcc.Markdown:
                                        id: bob-pub-key
                                - dbc.Col:
                                    width: 3
                                    children:
                                    - dbc.Label:
                                        children: Shared Secret
                                    - dcc.Markdown:
                                        id: bob-shared-secret
                    - dbc.Row:
                        children:
                          - dbc.Col:
                              width: 6
                              children:
                              - html.Div:
                                  id: pub-graph-alice-outer
                                  children:
                                  - dcc.Graph:
                                      id: pub-graph-alice
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: secret-graph-alice-outer
                                  children:
                                  - dcc.Graph:
                                      id: secret-graph-alice
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: encrypt-alice-outer
                                  children:
                                  - html.Br:
                                  - dbc.Input:
                                      id: alice-message
                                      placeholder: put your secrets here
                                      type: text
                                      value: My name is Alice
                                  - dbc.Textarea:
                                      id: alice-encrypted
                                      value:
                                      placeholder: Shared secret required
                                      style:
                                        height: 135
                                  - dbc.Button:
                                      id: alice-send
                                      children: Send
                                      color: primary


                          - dbc.Col:
                              width: 6
                              children:
                              - html.Div:
                                  id: pub-graph-bob-outer
                                  children:
                                  - dcc.Graph:
                                      id: pub-graph-bob
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: secret-graph-bob-outer
                                  children:
                                  - dcc.Graph:
                                      id: secret-graph-bob
                                      mathjax: True
                                      config:
                                        displayModeBar: False
                                      figure: ${empty_graph}
                              - html.Div:
                                  id: encrypt-bob-outer
                                  children:
                                  - html.Br:
                                  - dbc.Input:
                                      id: bob-message
                                      placeholder: put your secrets here
                                      type: text
                                      value: My name is Bob
                                  - dbc.Textarea:
                                      id: bob-encrypted
                                      value:
                                      placeholder: Shared secret required
                                      style:
                                        height: 135
                                  - dbc.Button:
                                      id: bob-send
                                      children: Send
                                      color: primary
                              - html.Div:
                                  id: decrypt-bob-outer
                                  children:
                                  - html.Br:
                                  - dbc.Textarea:
                                      id: bob-decrypt
                                      value:
                                      placeholder: Decrypt message here
                                      style:
                                        height: 135
                              

callbacks:
  add_graph:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: add-points
        attr: data
    output:
      - id: add-graph
        attr: figure

    callback: elliptic.dashboard.add_graph

  multiply_graph:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: user-input-n
        attr: value
      - id: multiply-points
        attr: data
    output:
      - id: multiply-graph
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  update_slider_label:
    input:
      - id: user-input-p
        attr: value
    output:
      - id: user-input-p
        attr: handleLabel
    callback: elliptic.dashboard.update_p_slider_label


  update_bob_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: secret-graph-bob
        attr: clickData
    state:
      - id: bob-secret
        attr: data
    output:
      - id: bob-secret
        attr: data
    callback: elliptic.dashboard.update_multiply_points


  update_alice_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: secret-graph-alice
        attr: clickData
    state:
      - id: alice-secret
        attr: data
    output:
      - id: alice-secret
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  render_alice_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-pub
        attr: data
    output:
      - id: alice-pub-key
        attr: children
    callback: elliptic.dashboard.render_pub_key

  render_alice_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-secret
        attr: data
    output:
      - id: alice-shared-secret
        attr: children
    callback: elliptic.dashboard.render_pub_key


  render_bob_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-pub
        attr: data
    output:
      - id: bob-pub-key
        attr: children
    callback: elliptic.dashboard.render_pub_key

  render_bob_secret:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-secret
        attr: data
    output:
      - id: bob-shared-secret
        attr: children
    callback: elliptic.dashboard.render_pub_key

  update_alice_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: pub-graph-alice
        attr: clickData
    state:
      - id: alice-pub
        attr: data
    output:
      - id: alice-pub
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  update_alice_priv_bounds:
    input:
    - id: user-input-p
      attr: value
    - id: user-input-a
      attr: value
    - id: user-input-b
      attr: value
    - id: pub-graph-alice
      attr: clickData
    state:
    - id: alice-priv
      attr: value
    output:
    - id: alice-priv
      attr: max
    - id: alice-priv
      attr: value
    callback: elliptic.dashboard.priv_in_bounds

  update_bob_priv_bounds:
    input:
    - id: user-input-p
      attr: value
    - id: user-input-a
      attr: value
    - id: user-input-b
      attr: value
    - id: pub-graph-bob
      attr: clickData
    state:
    - id: bob-priv
      attr: value
    output:
    - id: bob-priv
      attr: max
    - id: bob-priv
      attr: value
    callback: elliptic.dashboard.priv_in_bounds

  pub_graph_alice:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: alice-pub
        attr: data
      - id: alice-sharing-mode
        attr: value
    output:
      - id: pub-graph-alice
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  secret_graph_alice:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: alice-priv
        attr: value
      - id: alice-secret
        attr: data
      - id: alice-sharing-mode
        attr: value
    output:
      - id: secret-graph-alice
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  secret_graph_bob:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: bob-secret
        attr: data
      - id: bob-sharing-mode
        attr: value
    output:
      - id: secret-graph-bob
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  show_hide_alice_pub:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  pub-graph-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_pub

  show_hide_alice_secret:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  secret-graph-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_secret


  show_hide_alice_encrypt:
    input:
      - id: alice-sharing-mode
        attr: value
    output:
      - id:  encrypt-alice-outer
        attr: style
    callback: elliptic.dashboard.show_hide_encrypt


  show_hide_bob_pub:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  pub-graph-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_pub

  show_hide_bob_secret:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  secret-graph-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_secret

  show_hide_bob_encrypt:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  encrypt-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_encrypt

  show_hide_bob_decrypt:
    input:
      - id: bob-sharing-mode
        attr: value
    output:
      - id:  decrypt-bob-outer
        attr: style
    callback: elliptic.dashboard.show_hide_decrypt

  update_bob_pub:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: pub-graph-bob
        attr: clickData
    state:
      - id: bob-pub
        attr: data
    output:
      - id: bob-pub
        attr: data
    callback: elliptic.dashboard.update_multiply_points


  pub_graph_bob:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: bob-priv
        attr: value
      - id: bob-pub
        attr: data
      - id: bob-sharing-mode
        attr: value
    output:
      - id: pub-graph-bob
        attr: figure
    callback: elliptic.dashboard.multiply_graph

  update_multiply_points:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: user-input-n
        attr: value
      - id: multiply-graph
        attr: clickData
    state:
      - id: multiply-points
        attr: data
    output:
      - id: multiply-points
        attr: data
    callback: elliptic.dashboard.update_multiply_points

  update_add_points:
    input:
      - id: user-input-p
        attr: value
      - id: user-input-a
        attr: value
      - id: user-input-b
        attr: value
      - id: add-graph
        attr: clickData
    state:
      - id: add-points
        attr: data
    output:
      - id: add-points
        attr: data
    callback: elliptic.dashboard.update_add_points


  encrypt_alice_message:
    input:
      - id: alice-shared-secret
        attr: children
      - id: alice-message
        attr: value
    output:
      - id: alice-encrypted
        attr: value
    callback: elliptic.dashboard.encrypt


  encrypt_bob_message:
    input:
      - id: bob-shared-secret
        attr: children
      - id: bob-message
        attr: value
    output:
      - id: bob-encrypted
        attr: value
    callback: elliptic.dashboard.encrypt


